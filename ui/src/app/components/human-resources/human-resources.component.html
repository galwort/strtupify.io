<div class="content-container">
  <div class="header">
    <div class="title">Human Resources</div>
  </div>

  <div class="focus-bank">
    <div class="bank-top">
      <div>
        <div class="bank-label">Focus points</div>
        <div class="bank-sub">Spend {{ skillPointCost | number: '1.0-0' }} focus points to raise a skill by 1.</div>
      </div>
      <div class="bank-balance">{{ focusPoints | number: '1.0-0' }}</div>
    </div>
    <div class="bank-status">
      <span *ngIf="refreshingRates" class="muted">Refreshing work item rates...</span>
      <span *ngIf="spendMessage && !refreshingRates" class="muted">{{ spendMessage }}</span>
      <span *ngIf="spendError" class="error">{{ spendError }}</span>
    </div>
  </div>

  <div *ngIf="!employees.length" class="empty-state">
    No active employees yet.
  </div>

  <div *ngFor="let emp of employees" class="employee-card">
    <div class="card-head">
      <div class="identity">
        <div class="avatar" [class.fallback]="!emp.avatarUrl">
          <img *ngIf="emp.avatarUrl" [src]="emp.avatarUrl" [alt]="emp.name + ' profile photo'" />
          <span *ngIf="!emp.avatarUrl" class="material-symbols-outlined">person</span>
        </div>
        <div class="name-block">
          <div class="name">{{ emp.name }}</div>
          <div class="subtitle">{{ emp.title }}</div>
        </div>
      </div>
      <div class="status" [ngClass]="statusClass(emp)">{{ statusLabel(emp) }}</div>
    </div>

    <div *ngIf="emp.description; else noDescription" class="description">
      {{ emp.description }}
    </div>
    <ng-template #noDescription>
      <div class="description muted">No description yet.</div>
    </ng-template>

    <div class="metrics">
      <div class="metric wide">
        <div class="label">Stress</div>
        <div class="progress-bar" [ngClass]="statusClass(emp)">
          <div
            class="progress-fill"
            [style.width.%]="emp.stress"
            [class.full-skill]="emp.stress >= 100"
            [ngClass]="statusClass(emp)"
          ></div>
        </div>
      </div>
      <div class="metric">
        <div class="label">Salary</div>
        <div class="value">
          {{ emp.salary ? (emp.salary | currency : "USD" : "symbol" : "1.0-0") : "Not set" }}
        </div>
      </div>
      <div class="metric">
        <div class="label">Tasks in progress</div>
        <div class="value">{{ emp.load }}</div>
      </div>
    </div>

    <div class="skills-section">
      <div class="label">Skill set</div>
      <div *ngIf="emp.skills?.length; else skillsEmpty" class="skills">
        <div class="skill-pill" *ngFor="let skill of emp.skills">
          <div class="skill-name">
            <div class="skill-label">{{ skill.name }}</div>
            <div class="skill-cost" *ngIf="skill.level < 10">
              {{ skillPointCost | number: '1.0-0' }} pts to add 1 level
            </div>
          </div>
          <div class="skill-meter">
            <div class="skill-fill" [style.width.%]="(skill.level / 10) * 100"></div>
          </div>
          <span class="skill-level">{{ skill.level }}/10</span>
          <button
            type="button"
            class="skill-upgrade"
            [disabled]="spending || refreshingRates || skill.level >= 10 || focusPoints < skillPointCost"
            (click)="upgradeSkill(emp, skill)"
          >
            {{
              skill.level >= 10
                ? 'Maxed'
                : spending
                ? 'Working...'
                : 'Upgrade'
            }}
          </button>
        </div>
      </div>
      <ng-template #skillsEmpty>
        <div class="muted">No skills added yet.</div>
      </ng-template>
    </div>
  </div>
</div>
