<div class="content-container">
  <div class="header">
    <div class="title">Inbox</div>
  </div>
  <div class="filter-container">
    <button class="filter-btn">
      <span class="material-symbols-outlined">add</span>
      <span class="label">NEW EMAIL</span>
    </button>
    <button
      class="filter-btn"
      (click)="openReply()"
      [disabled]="!selectedEmail"
    >
      <span class="material-symbols-outlined">reply</span>
      <span class="label">REPLY</span>
    </button>
    <button class="filter-btn" (click)="toggleDelete()">
      <span class="material-symbols-outlined">{{
        showDeleted ? "restore" : "delete"
      }}</span>
      <span class="label">{{ showDeleted ? "UNDELETE" : "DELETE" }}</span>
    </button>
    <button class="filter-btn" (click)="toggleSent()">
      <span class="material-symbols-outlined">outbox</span>
      <span class="label">{{ showSent ? "INBOX" : "SENT" }}</span>
    </button>
    <button class="filter-btn" (click)="archiveEmails()">
      <span class="material-symbols-outlined">{{
        showDeleted ? "inbox" : "archive"
      }}</span>
    </button>
  </div>
  <div class="inbox-body">
    <div class="email-list">
      <div
        class="email-item"
        *ngFor="let email of inbox"
        [class.selected]="email === selectedEmail"
        (click)="selectEmail(email)"
      >
        <div class="sender">{{ email.sender }}</div>
        <div class="subject">{{ email.subject }}</div>
        <div class="preview-text">{{ email.preview }}</div>
        <div class="timestamp">{{ email.timestamp | date : "short" }}</div>
      </div>
    </div>
    <div class="email-preview" *ngIf="selectedEmail">

      <div *ngIf="showReplyBox" class="reply-composer">
        <div class="row">
          <span class="label">To</span
          ><span class="value">{{ selectedEmail.sender }}</span>
        </div>
        <div class="row">
          <span class="label">Subject</span
          ><span class="value">{{ replySubject }}</span>
        </div>
        <textarea
          [(ngModel)]="replyText"
          rows="6"
          placeholder="Write your reply..."
          class="reply-textarea"
          (keydown)="onReplyKeydown($event)"
        ></textarea>
        <div class="actions">
          <button
            class="btn btn-primary"
            id="send-reply-btn"
            (click)="sendReply()"
            [class.sending]="sendingReply"
            [class.clicked]="clickedSend"
            [disabled]="sendingReply"
          >
            <span class="material-symbols-outlined">send</span>
            <span>Send</span>
          </button>
          <button class="btn" (click)="showReplyBox = false">
            <span class="material-symbols-outlined">close</span>
            <span>Cancel</span>
          </button>
        </div>
        <div class="original-sep">----- Original message -----</div>
      </div>


      <div class="email-content">
        <h2>{{ selectedEmail.subject }}</h2>
        <h4>From: {{ selectedEmail.sender }}</h4>
        <div class="timestamp">
          {{ selectedEmail.timestamp | date : "short" }}
        </div>
        <img *ngIf="selectedEmail.banner && selectedEmail.category === 'supereats'" src="assets/notubereats.png" class="banner-img" />
        <img *ngIf="selectedEmail.banner && selectedEmail.category === 'bank'" src="assets/notfifththird.png" class="banner-img" />
        <img *ngIf="selectedEmail.banner && !selectedEmail.category" src="assets/notubereats.png" class="banner-img" />
        <div
          class="email-body"
          [innerHTML]="renderEmailBody(selectedEmail.body)"
        ></div>
        <br />
        <br />
        <div *ngIf="threadMessages.length" class="thread-chain">
          <div class="original-sep">----- Previous messages -----</div>
          <br />
          <div class="thread-item" *ngFor="let m of threadMessages">
            <div class="thread-head">
              <span> From: {{ m.sender }}</span>
              <span> â€¢ {{ m.timestamp | date : "short" }}</span>
            </div>
            <br />
            <div
              class="thread-body"
              [innerHTML]="renderEmailBody(m.body)"
            ></div>
            <br />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
